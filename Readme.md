

# KBO 리그 우승 확률 시뮬레이터
이 프로젝트는 시즌 중 각 팀의 리그 우승 확률을 나타내는 스탯인 `Championship Win Probability(cWP)`과 파생 스탯을 계산하고 그 변화를 추적하고자 만들었습니다.

## Championship Win Probability란?
cWP란 이름 그대로, 어떤 `팀이 리그에서 우승할 확률을 의미합니다.` 이 스탯의 산출방법을 활용하면 팀이 특정 순위 안에 들 확률도 구할 수 있습니다. (예: 팀이 5위안에 들어서 포스트시즌에 진출할 확률)

### 보편적인 계산방법 (coin-toss simulation)
저명한 메이저리그 야구 기록 사이트인 [Baseball Reference에 따르면](https://www.baseball-reference.com/about/wpa.shtml), 우승확률은 계산 기점에서 아직 치르지 않은 경기들에 대해 coin-toss simulation, 즉, 각 팀의 승리확률이 50%라고 가정한 시뮬레이션 리그를 25,000회 치러 그 결과 우승한 확률로 계산됩니다. 일종의 [몬테카를로 방법](https://ko.wikipedia.org/wiki/%EB%AA%AC%ED%85%8C%EC%B9%B4%EB%A5%BC%EB%A1%9C_%EB%B0%A9%EB%B2%95)이라고 할 수 있죠!  
예를 들어, 25,000번 시뮬레이션을 한 결과 그 중 A팀이 우승한 횟수가 5,000번이었다면 A팀의 우승확률은 5,000/25,000 = 0.2 = 20%가 되는 것입니다.

### 이 프로젝트에서 추가로 제공하는 계산방법
그러나, 기존의 계산 방법은 각 경기의 승리확률이 50%로 고정되어 각 팀의 전력 차이를 반영하지 못한다는 한계점이 있습니다. 이에 착안하여, 본 프로젝트는 두 가지의 경기별 승률 보정을 제공합니다.
1. 전년도 상대전적을 활용한 시뮬레이션
이 방식에서는 시뮬레이션에서 각 경기의 승리확률로 전년도의 상대전적을 사용합니다.  
예를 들어, 2023시즌 LG 트윈스는 두산 베어스와의 경기에서 11승 5패로 상대승률 0.779를 기록했습니다. 이를 반영하여 LG 트윈스와 두산 베어스의 경기에서는 LG의 승리확률을 0.779로 적용하여 시뮬레이션을 진행하는 방식입니다.
2. Log5 방법을 활용한 시뮬레이션
Log5는 양 팀의 리그 승률을 기반으로 두 팀 간의 맞대결 기대승률을 계산하는 방법입니다. (구체적인 설명은 [FreeRedbird씨께서 작성하신 설명글](https://birdsnest.tistory.com/347)을 읽어봐주세요.)  
이 방식에서 승률이 a인 A팀이 승률이 b인 B팀을 상대로 이길 확률은 다음 수식과 같습니다.
$$\frac{P_a(1-P_b)}{P_a(1-P_b)+P_b(1-P_a)}$$
시뮬레이션 상에서는 위 식의 승률에 전년도의 리그 승률을 대입하여 각 경기의 승리확률에 적용합니다. 예를 들어, 작년 LG의 승률이 0.606이고, 키움의 승률은 0.521이었는데 이걸 위 식에 대입하면 LG가 키움과의 경기에서 승리할 확률은 0.586이 됩니다. 그리고 이 확률을 LG-키움 간의 경기에 일괄 적용하는 것입니다.

## Championship Leverage Index(cLI)
일반적인 Leverage Index(LI)가 한 경기 내에서 특정 타석의 중요도를 승리 확률의 변화량(Win Probability Added)을 통하여 평가하는 것이라면, cLI는 `한 시즌 내에서 특정 경기의 중요도를 우승 확률의 변화량을 통하여 평가하는 것`입니다.  

### cLI의 기준점
중요도는 주관적인 척도입니다. 따라서, 중요도를 수치로 정의하기 위하여 `기준이 되는 경기와 비교했을 때 몇 배나 중요한 경기인가?`로 cLI를 정의합니다. 이 때 기준이 되는 경기는 바로 개막전 경기입니다. 즉, 어떤 경기의 cLI가 2.0이라는 것은 그 경기가 우승에 있어 개막전에 비해 두 배 중요한 경기라는 뜻이 됩니다.

### cLI의 계산 방법
cLI의 계산은 두 번의 우승 확률 시뮬레이션을 통하여 이루어집니다. 한 번은 계산하고자 하는 경기를 승리했다고 가정하고 시뮬레이션하며, 다른 한 번은 동일한 경기를 패배했다고 가정하고 시뮬레이션합니다. 위의 우승 확률 시뮬레이션과 마찬가지로 각 시뮬레이션은 25,000회씩 실시됩니다.  
이렇게 시뮬레이션한 결과, 두 시뮬레이션의 우승 확률 차이가 cLI 계산의 척도가 됩니다. 위 단락에서 언급한 기준점인 개막전 경기는 승리했을 때와 패배했을 때의 우승 확률차이가 대략 0.02954(2.954%p)인 것으로 계산됩니다. (144경기 단일리그 체제 기준, coin-toss simulation 사용)  
이래를 돕기위해 (SSG 팬들에겐 죄송하지만) 2019년 두산의 우승을 사례로 cLI 계산을 해보겠습니다.  
시뮬레이션을 할 것도 없이, 당시 두산의 최종전에서 우승 확률 변화는 간단합니다. 이기면 우승 확률 100%(우승 확정), 지면 우승 확률 0%(우승 실패). 이 케이스에서 승패에 따른 우승 확률 변화는 1.0-0.0 = 1.0입니다. 위에서 언급했듯이 개막전에서 승패에 따른 우승 확률의 변화가 0.02954이므로, 이 경기의 cLI는 1.0/0.02954 = 33.852에 달합니다. 즉, 이 경기는 개막전에 비해 우승에 미치는 중요도가 33.8배나 되는 경기인 것입니다.